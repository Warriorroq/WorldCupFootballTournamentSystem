<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <title>Football tournament</title>
      <script src="eel.js"></script>
      <link rel="stylesheet" href="css/tournamentStyle.css" />
   </head>
   <body>
      <main>
         <h2 class="title">World cup Bracket 2022</h2>
         <!-- part 0 -->
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 135px;" tournamentLevel = "0">
            <h1 class="groupName">Group A</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 270px;" tournamentLevel = "0">
            <h1 class="groupName">Group B</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 405px;" tournamentLevel = "0">
            <h1 class="groupName">Group C</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 540px;" tournamentLevel = "0">
            <h1 class="groupName">Group D</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 675px;" tournamentLevel = "0">
            <h1 class="groupName">Group E</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 810px;" tournamentLevel = "0">
            <h1 class="groupName">Group F</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 945px;" tournamentLevel = "0">
            <h1 class="groupName">Group J</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 1080px;" tournamentLevel = "0">
            <h1 class="groupName">Group I</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <!-- part 1 -->
         <div class="group" style="position: absolute; margin-left: 345px; margin-top: 135px;" tournamentLevel = "1">
            <h1 class="groupName">Group E</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 345px; margin-top: 405px;" tournamentLevel = "1">
            <h1 class="groupName">Group F</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 345px; margin-top: 675px;" tournamentLevel = "1">
            <h1 class="groupName">Group J</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 345px; margin-top: 945px;" tournamentLevel = "1">
            <h1 class="groupName">Group I</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <!-- part 2 -->
         <div class="group" style="position: absolute; margin-left: 645px; margin-top: 135px;" tournamentLevel = "2">
            <h1 class="groupName">Group E</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 645px; margin-top: 405px;" tournamentLevel = "2">
            <h1 class="groupName">Group F</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <!-- part 3 -->
         <div class="group" style="position: absolute; margin-left: 945px; margin-top: 135px;" tournamentLevel = "3">
            <h1 class="groupName">Group E</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <button class="button" type="button" onclick="javascript:sendDataToBackend();">Click me</button>
      </main>      
   </body>
<script type="text/javascript">
const teamsData = new Map();
var matches = [];
var stage = 0;
var winner = null;

for (var i = 0; i < 4; i++)
    matches[i] = []

function loadData() {
    eel.readAllCountryImages()(function(result) {
        result.forEach((element) => teamsData.set(element[0], element[1]));
    });
}

function createDataContainers() {
   var arr = [...document.getElementsByClassName('group')];
   var lastRoundResults = [];

   eel.readGameStateData()(function (result) {
      lastRoundResults.push(result);
      console.log(lastRoundResults);        
   });

   for (var i = 0; i < arr.length; i++) {
      var groupHTMLTeams = [...arr[i].getElementsByClassName('team')];
      var teamsObjs = [];
      for (var j = 0; j < groupHTMLTeams.length; j++) {
         var team = {
            name: groupHTMLTeams[j].getElementsByClassName("teamName")[0],
            score: groupHTMLTeams[j].getElementsByClassName("score")[0],
            image: groupHTMLTeams[j].getElementsByClassName("teamImg")[0]
         }
         teamsObjs.push(team);
      }

      var match = {
         teams: teamsObjs,
         groupName: arr[i].getElementsByClassName("groupName")[0],
         level: parseInt(arr[i].getAttribute("tournamentLevel"))
      }
      matches[match.level].push(match);
   }
}

function readGameStateData(){
   eel.readGameStateData()(function(result) {
      for(var i =0; i < result.length; i++){
         var current = matches[stage][i];
         current.teams[0].name.innerHTML = result[i][0];
         current.teams[0].image.src = teamsData.get(result[i][0]);
         current.teams[1].name.innerHTML = result[i][1];
         current.teams[1].image.src = teamsData.get(result[i][1]);
         current.groupName.innerHTML = result[i][0] + " vs " + result[i][1];
      }
   });
}


function sendDataToBackend() {
   if(stage >= 3){
      var teams = matches[3].teams
      var winner = teams[0].score.value > teams[1].score.value ? teams[0] : teams[1]
      console.log(winner.name.innerHTML);
      return;
   }
   eel.readDataFromFontEnd(matches[stage].map(i => [i.teams[0].score.value, i.teams[1].score.value]))();
   stage += 1;
   readGameStateData();
}     

loadData();
createDataContainers();
readGameStateData();
 
</script>
</html>