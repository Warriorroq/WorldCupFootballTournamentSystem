<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <title>Football tournament</title>
      <script src="eel.js"></script>
      <link rel="stylesheet" href="css/tournamentStyle.css" />
   </head>
   <body>
      <main>
         <h2 class="title">World cup Bracket 2022</h2>
         <!-- part 0 -->
         <h3 class="final1_8">1/8 final</h3>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 135px;" tournamentLevel = "0">
            <h1 class="groupName">Group A</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 270px;" tournamentLevel = "0">
            <h1 class="groupName">Group B</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 405px;" tournamentLevel = "0">
            <h1 class="groupName">Group C</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 540px;" tournamentLevel = "0">
            <h1 class="groupName">Group D</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <h3 class="quarterfinal">Quarterfinals</h3>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 675px;" tournamentLevel = "0">
            <h1 class="groupName">Group E</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 810px;" tournamentLevel = "0">
            <h1 class="groupName">Group F</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 945px;" tournamentLevel = "0">
            <h1 class="groupName">Group J</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 45px; margin-top: 1080px;" tournamentLevel = "0">
            <h1 class="groupName">Group I</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <!-- part 1 -->
         <div class="group" style="position: absolute; margin-left: 345px; margin-top: 200px;" tournamentLevel = "1">
            <h1 class="groupName">Group E</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 345px; margin-top: 460px;" tournamentLevel = "1">
            <h1 class="groupName">Group F</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 345px; margin-top: 750px;" tournamentLevel = "1">
            <h1 class="groupName">Group J</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 345px; margin-top: 1010px;" tournamentLevel = "1">
            <h1 class="groupName">Group I</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <!-- part 2 -->
         <h3 class="semifinal">Semifinal</h3>
         <div class="group" style="position: absolute; margin-left: 645px; margin-top: 335px;" tournamentLevel = "2">
            <h1 class="groupName">Group E</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <div class="group" style="position: absolute; margin-left: 645px; margin-top: 885px;" tournamentLevel = "2">
            <h1 class="groupName">Group F</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <!-- part 3 -->
         <h3 class="final">Final</h3>
         <div class="group" style="position: absolute; margin-left: 945px; margin-top: 635px;" tournamentLevel = "3">
            <h1 class="groupName">Group E</h1>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
            <div class="team">
               <img class="teamImg" />
               <h3 class="teamName">Team</h3>
               <input type = "number" class = "score" value = "0"/>
            </div>
         </div>
         <button class="button" type="button" onclick="javascript:sendDataToBackend();" style="bottom: 10%; right: 10%; position: fixed;">Proceed</button>
         <div class="alert" style="top: 10%;
         left: 10%;
         width: 80%;
         border-radius: 10px;
         height: 80%;
         position: fixed;
         background-color: #d90039f0;
         display: none;">
            <img class = "alertImg" style="top: 10%;
            left: 10%;
            width: 80%;
            height: 60%;
            position: relative;" />
            <strong style="top:10%; position: relative; text-align:center;"><h1 style="font-family: 'Permanent Marker', cursive;
               font-size: 75px;
               color: #eeeeee;
               text-align: center;" class = "alertText">Winner!</h1></strong>
               <div class="firework"></div>
               <div class="firework"></div>
               <div class="firework"></div>
         </div>
      </main>      
   </body>
<script type="text/javascript">
const teamsData = new Map();
var matches = [];
var stage = 0;
var winner = null;

for (var i = 0; i < 4; i++)
    matches[i] = []

function loadData() {
    eel.readAllCountryImages()(function(result) {
        result.forEach((element) => teamsData.set(element[0], element[1]));
    });
}

function createDataContainers() {
   var arr = [...document.getElementsByClassName('group')];
   var lastRoundResults = [];

   eel.readGameStateData()(function (result) {
      lastRoundResults.push(result);
   });

   for (var i = 0; i < arr.length; i++) {
      var groupHTMLTeams = [...arr[i].getElementsByClassName('team')];
      var teamsObjs = [];
      for (var j = 0; j < groupHTMLTeams.length; j++) {
         var team = {
            name: groupHTMLTeams[j].getElementsByClassName("teamName")[0],
            score: groupHTMLTeams[j].getElementsByClassName("score")[0],
            image: groupHTMLTeams[j].getElementsByClassName("teamImg")[0]
         }
         teamsObjs.push(team);
      }

      var match = {
         teams: teamsObjs,
         groupName: arr[i].getElementsByClassName("groupName")[0],
         level: parseInt(arr[i].getAttribute("tournamentLevel"))
      }
      matches[match.level].push(match);
   }
}

function readGameStateData(){
   eel.readGameStateData()(function(result) {
      for(var i =0; i < result.length; i++){
         var current = matches[stage][i];
         current.teams[0].name.innerHTML = result[i][0];
         current.teams[0].image.src = teamsData.get(result[i][0]);
         current.teams[1].name.innerHTML = result[i][1];
         current.teams[1].image.src = teamsData.get(result[i][1]);
         current.groupName.innerHTML = result[i][0] + " vs " + result[i][1];
      }
   });
}


function sendDataToBackend() {
   if(stage >= 3){
      var teams = matches[3][0].teams;
      winner = teams[0].score.value > teams[1].score.value ? teams[0] : teams[1];
      var alertDiv = document.getElementsByClassName('alert')[0];
      alertDiv.style.display = "";
      var img = alertDiv.getElementsByClassName("alertImg")[0];
      img.src = teamsData.get(winner.name.innerHTML);
      var text = alertDiv.getElementsByClassName("alertText")[0];
      text.innerHTML = winner.name.innerHTML + " is winner!"
   }
   eel.readDataFromFontEnd(matches[stage].map(i => [i.teams[0].score.value, i.teams[1].score.value]))();
   stage += 1;
   readGameStateData();
}        

loadData();
createDataContainers();
readGameStateData();
 
</script>
</html>