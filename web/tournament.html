<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <title>Football tournament</title>
      <script src="eel.js"></script>
      <link rel="stylesheet" href="css/tournamentStyle.css" />
   </head>
   <body>
      <main>
         <div id = "global-event-anchor"></div>
         <h2 class="title">World cup Bracket 2022</h2>
         <div class = "r11">
            <div class="group" style="    position: absolute;
               margin-left: 45px;" tournamentLevel = "0">
               <h1 class="groupName">Group A</h1>
               <div class="team" class="country_block">
                  <img class="teamImg" />
                  <h3 class="teamName">Team</h3>
                  <input type = "number" class = "score" value = "0"/>
               </div>
               <div class="team">
                  <img class="teamImg" />
                  <h3 class="teamName">Team</h3>
                  <input type = "number" class = "score" value = "0"/>
               </div>
            </div>
            <div class = "childs">
               <div class="group" style="    position: absolute;
                  margin-left: 45px;
                  margin-top: 150px;" tournamentLevel = "0">
                  <h1 class="groupName">Group B</h1>
                  <div class="team" class="country_block">
                     <img class="teamImg" />
                     <h3 class="teamName">Team</h3>
                     <input type = "number" class = "score" value = "0"/>
                  </div>
                  <div class="team">
                     <img class="teamImg" />
                     <h3 class="teamName">Team</h3>
                     <input type = "number" class = "score" value = "0"/>
                  </div>
                  <div class = "childs">
                     <div class="group" style="    position: absolute;
                        margin-left: 0px;
                        margin-top: 250px;" tournamentLevel = "0">
                        <h1 class="groupName">Group C</h1>
                        <div class="team" class="country_block">
                           <img class="teamImg" />
                           <h3 class="teamName">Team</h3>
                           <input type = "number" class = "score" value = "0"/>
                        </div>
                        <div class="team">
                           <img class="teamImg" />
                           <h3 class="teamName">Team</h3>
                           <input type = "number" class = "score" value = "0"/>
                        </div>
                        <div class = "childs">
                           <div class="group" style="
                              position: absolute;
                              margin-left: 0px;
                              margin-top: 250px;" tournamentLevel = "0">
                              <h1 class="groupName">Group D</h1>
                              <div class="team" class="country_block">
                                 <img class="teamImg" />
                                 <h3 class="teamName">Team</h3>
                                 <input type = "number" class = "score" value = "0"/>
                              </div>
                              <div class="team">
                                 <img class="teamImg" />
                                 <h3 class="teamName">Team</h3>
                                 <input type = "number" class = "score" value = "0"/>
                              </div>
                           </div>
                           <div class="group" style="    position: absolute;
                              margin-left: 0px;
                              margin-top: 400px;" tournamentLevel = "0">
                              <h1 class="groupName">Group E</h1>
                              <div class="team" class="country_block">
                                 <img class="teamImg" />
                                 <h3 class="teamName">Team</h3>
                                 <input type = "number" class = "score" value = "0"/>
                              </div>
                              <div class="team">
                                 <img class="teamImg" />
                                 <h3 class="teamName">Team</h3>
                                 <input type = "number" class = "score" value = "0"/>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="group" style="    position: absolute;
                        margin-left: 0px;
                        margin-top: 700px;" tournamentLevel = "0">
                        <h1 class="groupName">Group F</h1>
                        <div class="team" class="country_block">
                           <img class="teamImg" />
                           <h3 class="teamName">Team</h3>
                           <input type = "number" class = "score" value = "0"/>
                        </div>
                        <div class="team">
                           <img class="teamImg" />
                           <h3 class="teamName">Team</h3>
                           <input type = "number" class = "score" value = "0"/>
                        </div>
                        <div class = "childs">
                           <div class="group" style="position: absolute;
                              margin-left: 0px;
                              margin-top: 250px;" tournamentLevel = "0">
                                 <h1 class="groupName">Group G</h1>
                                 <div id="team" class="country_block">
                                    <img class="teamImg" />
                                    <h3 class="teamName">Team</h3>
                                    <input type = "number" class = "score" value = "0"/>
                                 </div>
                                 <div id="team">
                                    <img class="teamImg" />
                                    <h3 class="teamName">Team</h3>
                                    <input type = "number" class = "score" value = "0"/>
                                 </div>
                              </div>
                              <div class="group" style="position: absolute;
                              margin-left: 280px;
                              margin-top: -260px;" tournamentLevel = "1">
                                 <h1 class="groupName">Group J</h1>
                                 <div id="team" class="country_block">
                                    <img class="teamImg" />
                                    <h3 class="teamName">Team</h3>
                                    <input type = "number" class = "score" value = "0"/>
                                 </div>
                                 <div id="team">
                                    <img class="teamImg" />
                                    <h3 class="teamName">Team</h3>
                                    <input type = "number" class = "score" value = "0"/>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="group" style="position: absolute;
                  margin-left: 320px;
                  margin-top: 85px;" tournamentLevel = "1">
                     <h1 class="groupName">Group I</h1>
                     <div id="team" class="country_block">
                        <img class="teamImg" />
                        <h3 class="teamName">Team</h3>
                        <input type = "number" class = "score" value = "0"/>
                     </div>
                     <div id="team">
                        <img class="teamImg" />
                        <h3 class="teamName">Team</h3>
                        <input type = "number" class = "score" value = "0"/>
                     </div>
                     <div class = "childs">
                        <div class="group" style="position: absolute;
                        margin-left: -275px;
                        margin-top: 1065px;" tournamentLevel = "0">
                           <h1 class="groupName">Group H</h1>
                           <div id="team" class="country_block">
                              <img class="teamImg" />
                              <h3 class="teamName">Team</h3>
                              <input type = "number" class = "score" value = "0"/>
                           </div>
                           <div id="team">
                              <img class="teamImg" />
                              <h3 class="teamName">Team</h3>
                              <input type = "number" class = "score" value = "0"/>
                           </div>
                           <div class = "childs">
                              <div class="group" style="    position: absolute;
                              margin-left: 280px;
                              margin-top: -300px;" tournamentLevel = "1">
                              <h1 class="groupName">Group K</h1>
                              <div class="team" class="country_block">
                                 <img class="teamImg" />
                                 <h3 class="teamName">Team</h3>
                                 <input type = "number" class = "score" value = "0"/>
                              </div>
                              <div class="team">
                                 <img class="teamImg" />
                                 <h3 class="teamName">Team</h3>
                                 <input type = "number" class = "score" value = "0"/>
                              </div>
                           </div>
                           <div class="group" style="position: absolute;
                              margin-left: 280px;
                              margin-top: 0px;" tournamentLevel = "1">
                                 <h1 class="groupName">Group L</h1>
                                 <div id="team" class="country_block">
                                    <img class="teamImg" />
                                    <h3 class="teamName">Team</h3>
                                    <input type = "number" class = "score" value = "0"/>
                                 </div>
                                 <div id="team">
                                    <img class="teamImg" />
                                    <h3 class="teamName">Team</h3>
                                    <input type = "number" class = "score" value = "0"/>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="group" style="
                        margin-top: 250px;
                        position: absolute;
                        margin-left: 300px;" tournamentLevel = "2">
                        <h1 class="groupName">Group M</h1>
                        <div class="team" class="country_block">
                           <img class="teamImg" />
                           <h3 class="teamName">Team</h3>
                           <input type = "number" class = "score" value = "0"/>
                        </div>
                        <div class="team">
                           <img class="teamImg" />
                           <h3 class="teamName">Team</h3>
                           <input type = "number" class = "score" value = "0"/>
                        </div>
                        <div class = "childs">
                           <div class="group" style="    margin-left: 0px;
                              position: absolute;
                              margin-top: 665px;" tournamentLevel = "2">
                                 <h1 class="groupName">Group N</h1>
                                 <div id="team" class="country_block">
                                    <img class="teamImg" />
                                    <h3 class="teamName">Team</h3>
                                    <input type = "number" class = "score" value = "0"/>
                                 </div>
                                 <div id="team">
                                    <img class="teamImg" />
                                    <h3 class="teamName">Team</h3>
                                    <input type = "number" class = "score" value = "0"/>
                                 </div>
                              </div>
                              <div class="group" style="    position: absolute;
                              margin-left: 300px;
                              margin-top: 400px;" tournamentLevel = "3">
                              <h1 class="groupName">Group O</h1>
                              <div class="team" class="country_block">
                                 <img class="teamImg" />
                                 <h3 class="teamName">Team</h3>
                                 <input type = "number" class = "score" value = "0"/>
                              </div>
                              <div class="team">
                                 <img class="teamImg" />
                                 <h3 class="teamName">Team</h3>
                                 <input type = "number" class = "score" value = "0"/>
                              </div>
                              <button class="button" type="button" onclick="javascript:sendDataToBackend();">Click me</button>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         </div>
      </main>
      <script type="text/javascript">
const teamsData = new Map();
var lastRoundResults = [];
var matches = [];
var stage = 0;

for (var i = 0; i < 4; i++)
    matches[i] = []

function loadData() {
    eel.readAllCountryImages()(function(result) {
        result.forEach((element) => teamsData.set(element[0], element[1]));
    });
}

function createDataContainers() {
    var arr = [...document.getElementsByClassName('group')];

    for (var i = 0; i < arr.length; i++) {
        var groupHTMLTeams = [...arr[i].getElementsByClassName('team')].slice(0, 2);
        var teamsObjs = [];

        for (var j = 0; j < groupHTMLTeams.length; j++) {
            var team = {
                name: groupHTMLTeams[j].getElementsByClassName("teamName")[0],
                score: groupHTMLTeams[j].getElementsByClassName("score")[0],
                image: groupHTMLTeams[j].getElementsByClassName("teamImg")[0]
            }
            teamsObjs.push(team);
        }

        var match = {
            teams: teamsObjs,
            groupName: arr[i].getElementsByClassName("groupName")[0],
            level: parseInt(arr[i].getAttribute("tournamentLevel"))
        }
        matches[match.level].push(match);
    }
}

createDataContainers();
loadData();
readGameStateData();

function readGameStateData(){
   eel.readGameStateData()(function(result) {
      for(var i =0; i < result.length; i++){
         var current = matches[stage][i];
         current.teams[0].name.innerHTML = result[i][0];
         current.teams[0].image.src = teamsData.get(result[i][0]);
         current.teams[1].name.innerHTML = result[i][1];
         current.teams[1].image.src = teamsData.get(result[i][1]);
         current.groupName.innerHTML = result[i][0] + " vs " + result[i][1];
      }
   });
}

function sendDataToBackend() {
      if(stage >= 3){
         //display winner
         eel.readGameStateData()(function(result){
            console.log(result);
         });
         return;  
      }
     eel.readDataFromFontEnd(matches[stage].map(i => [i.teams[0].score.value, i.teams[1].score.value]))();
     stage += 1;
     readGameStateData();
}
      </script>
   </body>
</html>